<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>S·∫£n ph·∫©m - CarShop</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      padding-top: 70px; /* tr√°nh navbar che n·ªôi dung */
    }
    /* Th∆∞∆°ng hi·ªáu n·ªïi b·∫≠t */
    .navbar-brand {
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: 0.6px;
      color: #fff !important;
      text-shadow: 0 2px 6px rgba(0,0,0,0.45);
    }
    .product-card {
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }
    .product-card:hover {
      transform: translateY(-5px);
    }
    .product-card img {
      height: 200px;
      object-fit: cover;
      width: 100%;



      transition: transform 0.25s ease, box-shadow 0.25s ease;
    }
    .product-card:hover img { transform: translateY(-6px) scale(1.03); box-shadow: 0 12px 30px rgba(0,0,0,0.18); }
    .product-card .card-body {
      text-align: center;
    }
    /* Ti√™u ƒë·ªÅ (t√™n xe) n·ªïi b·∫≠t h∆°n */
    .product-card .card-title {
      font-size: 1.12rem;
      font-weight: 800;
      color: #0b1320;
      margin-bottom: 0.5rem;
      transition: transform 0.18s ease, color 0.18s ease;
      display: inline-block;
    }
    .product-card:hover .card-title { transform: translateY(-4px); color: #c8102e; }

    /* Gi√° n·ªïi b·∫≠t */
    .price {
      font-weight: 900;
      font-size: 1.14rem;
      margin: 0.5rem 0;
      letter-spacing: 0.3px;
    }
    .price-red {
      color: #c8102e; /* ƒë·ªè n·ªïi b·∫≠t */
      background: rgba(200,16,46,0.06);
      padding: 6px 10px;
      border-radius: 8px;
      display: inline-block;
      box-shadow: 0 6px 18px rgba(200,16,46,0.08);
    }
    .product-card:hover .price-red { color: #9b081f; box-shadow: 0 10px 22px rgba(155,8,31,0.12); }
    footer {
      background: #222;
      color: #fff;
      text-align: center;
      padding: 15px;
      margin-top: 30px;
    }
    /* Canh menu sang ph·∫£i */
    .navbar-collapse {
      justify-content: flex-end;
    }
    .navbar-nav {
      text-align: right;
    }
    /* N√∫t reset filter g√≥c ph·∫£i trong v√πng s·∫£n ph·∫©m */
    #resetFilterBtn {
      position: absolute;
      top: 8px;
      right: 8px;
      width: 36px;
      height: 36px;
      padding: 0;
      border-radius: 50%;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
      box-shadow: 0 4px 10px rgba(0,0,0,0.12);
    }
    #resetFilterBtn:hover { transform: translateY(-1px); }
  /* Thumbnail nh·ªè trong modal chi ti·∫øt */
  .pd-thumbs { display: flex; gap: 8px; margin-top: 12px; justify-content: center; }
  .pd-thumbs img { width: 64px; height: 44px; object-fit: cover; border-radius: 6px; cursor: pointer; border: 2px solid transparent; }
  .pd-thumbs img.active { border-color: #c8102e; }
  .pd-thumb-wrap { position: relative; display: inline-block; }
  .pd-thumb-cart { position: absolute; right: 4px; top: 4px; background: rgba(0,0,0,0.6); color: #fff; border: none; padding: 4px 6px; border-radius: 6px; cursor: pointer; display: none; font-size: 12px; }
  .pd-thumb-wrap.active .pd-thumb-cart { display: inline-flex; align-items:center; justify-content:center; }
  .pd-main-overlay { position: absolute; right: 12px; top: 12px; background: rgba(0,0,0,0.6); color: #fff; border: none; padding: 8px 10px; border-radius: 8px; cursor: pointer; display: none; z-index: 5; }
  #pdModal .pd-main-container { position: relative; }
  @media (max-width: 576px) { .pd-thumb-cart { right: 6px; top: 6px; padding:6px 8px; } }
    /* Snackbar (th√¥ng b√°o d∆∞·ªõi c√πng) */
    .snackbar {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 20px;
      background: rgba(20,20,20,0.95);
      color: #fff;
      padding: 10px 14px;
      border-radius: 8px;
      display: flex;
      gap: 12px;
      align-items: center;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease, transform 0.25s ease;
      z-index: 3000;
    }
    .snackbar.show { opacity: 1; pointer-events: auto; transform: translateX(-50%) translateY(0); }
    .snackbar .btn-sb { background: transparent; border: 1px solid rgba(255,255,255,0.12); color: #fff; padding: 6px 10px; border-radius: 6px; cursor: pointer; }
    /* Mobile tweaks */
    @media (max-width: 576px) {
      .product-card img { height: auto; aspect-ratio: 16/9; }
      .product-card .card-body { padding: 12px; }
      .pd-thumbs img { width: 72px; height: 48px; }
      /* make thumbs container horizontally scrollable on small screens */
      .pd-thumbs { overflow-x: auto; flex-wrap: nowrap; padding-bottom: 6px; }
      /* Modal full screen on mobile */
      #pdModal > div { width: 100%; height: 100%; max-width: none; border-radius: 0; margin: 0; display: flex; flex-direction: column; padding: 12px; }
      .pd-main-img { height: calc(50vh); }
      .pd-thumbs { justify-content: flex-start; }
      .pd-price { font-size: 1.1rem; }
      #pdModal .pd-desc { font-size: 0.95rem; }
      #pdModal .btn { padding: 10px 14px; font-size: 1rem; }
    }
  </style>
</head>
<body>

  <!-- Navbar gi·ªëng index -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">CarShop</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="index.html">Trang ch·ªß</a></li>
          <li class="nav-item"><a class="nav-link active" href="product.html">S·∫£n ph·∫©m</a></li>
          <li class="nav-item"><a class="nav-link" href="contact.html">Li√™n h·ªá</a></li>
          <li class="nav-item position-relative">
            <a class="nav-link" href="cart.html">Gi·ªè h√†ng üõí</a>
            <span id="cartCount" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Danh s√°ch s·∫£n ph·∫©m -->
  <div class="container my-5">
    <h2 id="pageTitle" class="text-center mb-4">üöó Danh s√°ch xe h∆°i</h2>
    <div style="position:relative;">
      <button id="resetFilterBtn" class="btn btn-outline-secondary" title="Hi·ªÉn th·ªã t·∫•t c·∫£ s·∫£n ph·∫©m">‚ü≤</button>
      <div class="row g-4" id="productGrid"></div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 CarShop - All rights reserved</p>
  </footer>
  <!-- Modal chi ti·∫øt s·∫£n ph·∫©m -->
  <div id="pdModal" role="dialog" aria-hidden="true" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:4000;">
    <div style="background:#fff; max-width:900px; width:92%; margin:auto; border-radius:10px; padding:18px; position:relative;">
      <button aria-label="Quay l·∫°i danh s√°ch s·∫£n ph·∫©m" id="pdBackBtn" onclick="backToProducts()" title="Quay l·∫°i" tabindex="0" style="position:absolute; left:12px; top:12px; background:rgba(255,255,255,0.9); border:none; font-size:18px; color:#333; padding:6px; border-radius:6px; z-index:4100;">
        <!-- left arrow SVG -->
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L6.707 7l4.647 4.646a.5.5 0 0 1-.708.708l-5-5a.5.5 0 0 1 0-.708l5-5a.5.5 0 0 1 .708 0z"/></svg>
      </button>
      <button aria-label="ƒê√≥ng" onclick="closeProductDetail()" style="position:absolute; right:12px; top:12px; background:transparent; border:none; font-size:20px;">√ó</button>
      <div style="display:flex; gap:18px; flex-wrap:wrap; align-items:flex-start;">
        <div style="flex:1 1 480px; text-align:center;">
          <div class="pd-main-container" style="position:relative;">
            <img class="pd-main-img" src="" alt="·∫¢nh s·∫£n ph·∫©m" style="width:100%; height:420px; object-fit:cover; border-radius:8px;">
            <button class="pd-main-overlay" id="pdMainCartBtn">üõí</button>
          </div>
          <div class="pd-thumbs"></div>
        </div>
        <div style="flex:0 1 340px;">
          <h4 class="pd-title"></h4>
          <p class="pd-price" style="font-weight:800; color:#c8102e;"></p>
          <p class="pd-desc">M√¥ t·∫£ ng·∫Øn: Xe ƒë·∫πp, m·∫°nh m·∫Ω v√† ph√π h·ª£p cho tr·∫£i nghi·ªám l√°i tuy·ªát v·ªùi.</p>
          <div class="d-flex align-items-center gap-2 mt-3">
            <div class="input-group input-group-sm" style="width:140px;">
              <button class="btn btn-outline-secondary" type="button" id="pdQtyMinus">‚àí</button>
              <input type="number" id="pdQtyInput" class="form-control text-center" value="1" min="1" aria-label="S·ªë l∆∞·ª£ng">
              <button class="btn btn-outline-secondary" type="button" id="pdQtyPlus">+</button>
            </div>
            <div style="margin-left:8px;"><button class="btn btn-primary" id="pdAddBtn">Th√™m v√†o gi·ªè</button></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Snackbar -->
  <div id="snackbar" class="snackbar" role="status" aria-live="polite">
    <div class="sb-msg">ƒê√£ th√™m m·ªôt s·∫£n ph·∫©m v√†o gi·ªè h√†ng</div>
    <button class="btn-sb" id="viewCartBtn">Xem gi·ªè h√†ng</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Gi·ªØ s·ªë l∆∞·ª£ng gi·ªè h√†ng ƒë·ªìng b·ªô
    function updateCartCount(){
      const cart = JSON.parse(localStorage.getItem("cart")) || [];
      const count = cart.reduce((acc,item)=>acc+item.quantity,0);
      document.getElementById("cartCount").textContent = count;
    }
    updateCartCount();

    // Danh s√°ch s·∫£n ph·∫©m (c√≥ thu·ªôc t√≠nh brand)
    const products = [
      { name: 'Xe Lamborghini', brand: 'lamborghini', price: 1200000000, img: '/images/lambor1.jpg', images: ['/images/lambor1.jpg','/images/lambor2.jpg','/images/lambor3.jpg'] },
      { name: 'Xe Bugatti', brand: 'bugatti', price: 800000000, img: '/images/bugatti1.jpg', images: ['/images/bugatti1.jpg','/images/bugatti2.jpg','/images/bugatti3.jpg'] },
      { name: 'Xe Ferrari 488 GTB', brand: 'ferrari', price: 1500000000, img: '/images/ferrari1.jpg', images: ['/images/ferrari1.jpg','/images/ferrari2.jpg','/images/ferrari3.jpg'] },
      { name: 'Xe Porche', brand: 'porche', price: 900000000, img: '/images/porche1.jpg', images: ['/images/porche1.jpg','/images/porche2.jpg','/images/porche3.jpg'] },
      { name: 'Xe Mercedes', brand: 'mercedes', price: 700000000, img: '/images/mercedes1.jpg', images: ['/images/mercedes1.jpg','/images/mercedes2.jpg','/images/mercedes3.jpg'] },
      { name: 'Xe Audi', brand: 'audi', price: 500000000, img: '/images/audi1.jpg', images: ['/images/audi1.jpg','/images/audi2.jpg','/images/audi3.jpg'] },
    ];

    // M√¥ t·∫£ ng·∫Øn v√† th√¥ng s·ªë k·ªπ thu·∫≠t cho t·ª´ng s·∫£n ph·∫©m (hi·ªÉn th·ªã trong modal)
    const productDescriptions = {
      'Xe Lamborghini': {
        short: 'Si√™u xe hi·ªáu su·∫•t cao, thi·∫øt k·∫ø hung h√£n v√† √¢m thanh ƒë·ªông c∆° ƒë·∫ßy uy l·ª±c. Ph√π h·ª£p cho ng∆∞·ªùi th√≠ch t·ªëc ƒë·ªô v√† c√° t√≠nh n·ªïi b·∫≠t.',
        specs: `
          <ul>
            <li>ƒê·ªông c∆°: V10/V12 (t√πy phi√™n b·∫£n)</li>
            <li>Dung t√≠ch: ~5.2‚Äì6.5 L</li>
            <li>C√¥ng su·∫•t: ~610‚Äì770 m√£ l·ª±c</li>
            <li>0‚Äì100 km/h: ~2.8‚Äì3.5 gi√¢y</li>
            <li>V·∫≠n t·ªëc t·ªëi ƒëa: ~325‚Äì350+ km/h</li>
            <li>H·ªá truy·ªÅn ƒë·ªông: AWD ho·∫∑c RWD</li>
          </ul>`
      },
      'Xe Bugatti': {
        short: 'ƒê·ªânh cao v·ªÅ t·ªëc ƒë·ªô v√† k·ªπ thu·∫≠t ‚Äî si√™u xe h·∫°ng si√™u gi·ªõi h·∫°n v·ªõi c√¥ng su·∫•t c·ª±c l·ªõn v√† n·ªôi th·∫•t si√™u sang.',
        specs: `
          <ul>
            <li>ƒê·ªông c∆°: W16 tƒÉng √°p k√©p</li>
            <li>Dung t√≠ch: ~8.0 L</li>
            <li>C√¥ng su·∫•t: ~1.000‚Äì1.600+ m√£ l·ª±c</li>
            <li>0‚Äì100 km/h: ~2.2‚Äì2.6 gi√¢y</li>
            <li>V·∫≠n t·ªëc t·ªëi ƒëa: >400 km/h (phi√™n b·∫£n ƒë·∫∑c bi·ªát)</li>
            <li>H·ªá truy·ªÅn ƒë·ªông: AWD</li>
          </ul>`
      },
      'Xe Ferrari 488 GTB': {
        short: 'Si√™u xe th·ªÉ thao thu·∫ßn ch·∫•t c·ªßa Ferrari: ph·∫£n ·ª©ng tay l√°i nh·∫°y, ƒë·ªông c∆° V8 tƒÉng √°p v√† tr·∫£i nghi·ªám l√°i s·ªëng ƒë·ªông.',
        specs: `
          <ul>
            <li>ƒê·ªông c∆°: V8 tƒÉng √°p k√©p</li>
            <li>Dung t√≠ch: ~3.9 L</li>
            <li>C√¥ng su·∫•t: ~660‚Äì670 m√£ l·ª±c</li>
            <li>0‚Äì100 km/h: ~3.0 gi√¢y</li>
            <li>V·∫≠n t·ªëc t·ªëi ƒëa: ~330 km/h</li>
            <li>H·ªá truy·ªÅn ƒë·ªông: RWD</li>
          </ul>`
      },
      'Xe Porche': {
        short: 'Porsche c√¢n b·∫±ng gi·ªØa hi·ªáu nƒÉng cao v√† ti·ªán d·ª•ng h√†ng ng√†y: x·ª≠ l√Ω ch√≠nh x√°c, khung g·∫ßm v·ªØng v√† c√¥ng ngh·ªá ti√™n ti·∫øn.',
        specs: `
          <ul>
            <li>ƒê·ªông c∆°: Boxer 6 xy-lanh, tƒÉng √°p</li>
            <li>Dung t√≠ch: ~3.0 L</li>
            <li>C√¥ng su·∫•t: ~430‚Äì650 m√£ l·ª±c (t√πy m·∫´u)</li>
            <li>0‚Äì100 km/h: ~2.7‚Äì4.0 gi√¢y</li>
            <li>V·∫≠n t·ªëc t·ªëi ƒëa: ~300‚Äì330 km/h</li>
            <li>H·ªá truy·ªÅn ƒë·ªông: RWD / AWD</li>
          </ul>`
      },
      'Xe Mercedes': {
        short: 'K·∫øt h·ª£p gi·ªØa sang tr·ªçng v√† s·ª©c m·∫°nh; c√°c phi√™n b·∫£n AMG ƒëem l·∫°i tr·∫£i nghi·ªám l√°i th·ªÉ thao c√πng ti·ªán nghi cao c·∫•p.',
        specs: `
          <ul>
            <li>ƒê·ªông c∆°: V6/V8 tƒÉng √°p ho·∫∑c hybrid</li>
            <li>Dung t√≠ch: ~3.0‚Äì4.0 L</li>
            <li>C√¥ng su·∫•t: ~400‚Äì630 m√£ l·ª±c (AMG)</li>
            <li>0‚Äì100 km/h: ~3.0‚Äì4.5 gi√¢y</li>
            <li>V·∫≠n t·ªëc t·ªëi ƒëa: ~250‚Äì320 km/h</li>
            <li>H·ªá truy·ªÅn ƒë·ªông: RWD / AWD</li>
          </ul>`
      },
      'Xe Audi': {
        short: 'Audi mang ƒë·∫øn hi·ªáu su·∫•t ·ªïn ƒë·ªãnh, c√¥ng ngh·ªá cao v√† h·ªá d·∫´n ƒë·ªông quattro n·ªïi ti·∫øng ‚Äî ph√π h·ª£p cho l√°i th·ªÉ thao v√† s·ª≠ d·ª•ng h√†ng ng√†y.',
        specs: `
          <ul>
            <li>ƒê·ªông c∆°: V10 ho·∫∑c V6 tƒÉng √°p (t√πy m·∫´u)</li>
            <li>Dung t√≠ch: ~2.9‚Äì5.2 L</li>
            <li>C√¥ng su·∫•t: ~450‚Äì620 m√£ l·ª±c</li>
            <li>0‚Äì100 km/h: ~3.0‚Äì3.8 gi√¢y</li>
            <li>V·∫≠n t·ªëc t·ªëi ƒëa: ~305‚Äì330 km/h</li>
            <li>H·ªá truy·ªÅn ƒë·ªông: AWD (quattro)</li>
          </ul>`
      }
    };

    // L·∫•y brand t·ª´ query string n·∫øu c√≥ v√† l·ªçc s·∫£n ph·∫©m
    function getQueryParam(name){
      return new URLSearchParams(window.location.search).get(name);
    }

  const brandLabels = { lamborghini: 'Lamborghini', bugatti: 'Bugatti', ferrari: 'Ferrari', pickup: 'Pickup', codien: 'C·ªï ƒêi·ªÉn', mini: 'Mini' };

    function renderProducts(){
      const grid = document.getElementById('productGrid');
      grid.innerHTML = '';
      const brand = getQueryParam('brand');
      const titleEl = document.getElementById('pageTitle');
      const breadcrumbItems = document.querySelectorAll('.breadcrumb .breadcrumb-item');
        const resetBtn = document.getElementById('resetFilterBtn');
      if(brand){
        const label = brandLabels[brand] || brand;
        // title becomes a link to reset filter
        titleEl.innerHTML = `<a href="product.html" class="text-decoration-none text-dark">üöó S·∫£n ph·∫©m h√£ng: ${label}</a>`;
        // make breadcrumb second item link back to product page (show all)
        if(breadcrumbItems.length > 1){
          breadcrumbItems[1].innerHTML = `<a href="product.html">S·∫£n ph·∫©m</a>`;
          breadcrumbItems[1].classList.remove('active');
          breadcrumbItems[1].removeAttribute('aria-current');
        }
        // show reset button
        if(resetBtn) resetBtn.style.display = 'inline-flex';
      } else {
        titleEl.textContent = 'üöó Danh s√°ch xe h∆°i';
        if(breadcrumbItems.length > 1){
          breadcrumbItems[1].textContent = 'S·∫£n ph·∫©m';
          breadcrumbItems[1].classList.add('active');
          breadcrumbItems[1].setAttribute('aria-current','page');
        }
        if(resetBtn) resetBtn.style.display = 'none';
      }
      const filtered = brand ? products.filter(p => p.brand === brand) : products;
      if(brand && filtered.length === 0){
        grid.innerHTML = '<div class="col-12"><p class="text-center">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m cho h√£ng n√†y.</p></div>';
        return;
      }
      filtered.forEach(p => {
        const imgLinkStart = brand ? '<a href="product.html" class="d-block">' : '';
        const imgLinkEnd = brand ? '</a>' : '';
        const titleStart = brand ? '<a href="product.html" class="text-decoration-none text-dark">' : '';
        const titleEnd = brand ? '</a>' : '';
        grid.innerHTML += `
          <div class="col-md-4">
            <div class="card product-card">
              ${imgLinkStart}<img src="${p.img}" class="card-img-top" alt="${p.name}" onclick="openProductDetail(${products.indexOf(p)})">${imgLinkEnd}
              <div class="card-body text-center">
                <h5 class="card-title">${titleStart}${p.name}${titleEnd}</h5>
                <p class="card-text">Gi√°: <span class="price price-red">${p.price.toLocaleString()} VNƒê</span></p>
                <button class="btn btn-primary" onclick="openProductDetail(${products.indexOf(p)})">Mua ngay</button>
              </div>
            </div>
          </div>`;
      });
    }

    // Modal chi ti·∫øt s·∫£n ph·∫©m
    function openProductDetail(index){
      const p = products[index];
      if(!p) return;
      window._currentPdIndex = index;
      const modal = document.getElementById('pdModal');
      modal.querySelector('.pd-title').textContent = p.name;
      modal.querySelector('.pd-price').textContent = p.price.toLocaleString() + ' VNƒê';
      const mainImg = modal.querySelector('.pd-main-img');
      mainImg.src = p.images && p.images[0] ? p.images[0] : p.img;
      const thumbs = modal.querySelector('.pd-thumbs');
      thumbs.innerHTML = '';
      const images = p.images && p.images.length ? p.images.slice(0,3) : [p.img];
      images.forEach((src, i) => {
        const wrap = document.createElement('span');
        wrap.className = 'pd-thumb-wrap';
        const img = document.createElement('img');
        img.src = src;
        img.className = 'pd-thumb-img';
        if(i === 0) img.classList.add('active');

        // cart overlay per-thumb
        const cartBtn = document.createElement('button');
        cartBtn.className = 'pd-thumb-cart';
        cartBtn.title = 'Th√™m ·∫£nh n√†y v√†o gi·ªè';
        cartBtn.innerHTML = 'üõí';
        cartBtn.addEventListener('click', function(e){
          e.stopPropagation();
          // use current qty
          const qtyInput = modal.querySelector('#pdQtyInput');
          let qty = 1; if(qtyInput) qty = Math.max(1, parseInt(qtyInput.value) || 1);
          addToCart(p.name, p.price, src, qty);
        });

        img.addEventListener('click', function(){
          mainImg.src = src;
          thumbs.querySelectorAll('.pd-thumb-wrap').forEach(w=>w.classList.remove('active'));
          wrap.classList.add('active');
        });

        wrap.appendChild(img);
        wrap.appendChild(cartBtn);
        if(i === 0) wrap.classList.add('active');
        thumbs.appendChild(wrap);
      });
      // reset qty to 1 when opening modal
      const qtyInput = modal.querySelector('#pdQtyInput');
      if(qtyInput) qtyInput.value = 1;
      // fill description + specs
      const descEl = modal.querySelector('.pd-desc');
      if(descEl){
        const info = productDescriptions[p.name];
        if(info){
          descEl.innerHTML = `<strong>${info.short}</strong>` + info.specs;
        } else {
          descEl.textContent = 'M√¥ t·∫£ ng·∫Øn: Xe ƒë·∫πp, m·∫°nh m·∫Ω v√† ph√π h·ª£p cho tr·∫£i nghi·ªám l√°i tuy·ªát v·ªùi.';
        }
      }
      // ensure main overlay visible when thumb active and wire its action
      const firstActive = modal.querySelector('.pd-thumb-wrap.active');
      const mainCartBtn = modal.querySelector('#pdMainCartBtn');
      if(mainCartBtn){
        if(firstActive){
          firstActive.classList.add('active');
        }
        mainCartBtn.style.display = 'inline-block';
        // update main overlay to add currently selected image
        mainCartBtn.onclick = function(){
          // find active thumb or use mainImg
          const activeImg = thumbs.querySelector('.pd-thumb-wrap.active img');
          const chosen = activeImg ? activeImg.src : mainImg.src;
          const qtyInput = modal.querySelector('#pdQtyInput');
          let qty = 1; if(qtyInput) qty = Math.max(1, parseInt(qtyInput.value) || 1);
          addToCart(p.name, p.price, chosen, qty);
        };
      }
      // show modal (simple): display block and focus
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden','false');
    }

    function closeProductDetail(){
      const modal = document.getElementById('pdModal');
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden','true');
    }

    // Quay v·ªÅ danh s√°ch s·∫£n ph·∫©m: ƒë√≥ng modal v√† cu·ªôn t·ªõi l∆∞·ªõi s·∫£n ph·∫©m
    function backToProducts(){
      closeProductDetail();
      // scroll ƒë·∫øn khu v·ª±c s·∫£n ph·∫©m
      const grid = document.getElementById('productGrid');
      if(grid){
        grid.scrollIntoView({behavior: 'smooth', block: 'start'});
        // focus v√†o ph·∫ßn t·ª≠ s·∫£n ph·∫©m ƒë·∫ßu ti√™n ƒë·ªÉ h·ªó tr·ª£ keyboard
        const firstCard = grid.querySelector('.product-card .card-title, .product-card img');
        if(firstCard){
          // ensure focusable
          if(!firstCard.hasAttribute('tabindex')){
            firstCard.setAttribute('tabindex', '-1');
            // focus then remove tabindex for cleanliness
            firstCard.focus();
            // remove tabindex on next tick
            setTimeout(()=>{ firstCard.removeAttribute('tabindex'); }, 200);
          } else {
            try{ firstCard.focus(); }catch(e){}
          }
        }
      }
    }

    // N√∫t th√™m v√†o gi·ªè t·ª´ modal
    document.getElementById('pdAddBtn').addEventListener('click', function(){
      const idx = window._currentPdIndex;
      if(typeof idx === 'number'){
        const p = products[idx];
        // L·∫•y ·∫£nh ƒëang hi·ªÉn th·ªã trong modal (thumbnail active / main image)
        const modal = document.getElementById('pdModal');
        const mainImg = modal.querySelector('.pd-main-img');
        const chosenImg = mainImg && mainImg.src ? mainImg.src : p.img;
        // ƒë·ªçc s·ªë l∆∞·ª£ng t·ª´ modal
        const qtyInput = modal.querySelector('#pdQtyInput');
        let qty = 1;
        if(qtyInput) qty = Math.max(1, parseInt(qtyInput.value) || 1);
        addToCart(p.name, p.price, chosenImg, qty);
        closeProductDetail();
      }
    });

    // Quantity controls in modal
    const pdQtyMinus = document.getElementById('pdQtyMinus');
    const pdQtyPlus = document.getElementById('pdQtyPlus');
    const pdQtyInput = document.getElementById('pdQtyInput');
    if(pdQtyMinus && pdQtyInput){
      pdQtyMinus.addEventListener('click', function(){
        const v = Math.max(1, (parseInt(pdQtyInput.value) || 1) - 1);
        pdQtyInput.value = v;
      });
    }
    if(pdQtyPlus && pdQtyInput){
      pdQtyPlus.addEventListener('click', function(){
        const v = Math.max(1, (parseInt(pdQtyInput.value) || 1) + 1);
        pdQtyInput.value = v;
      });
    }
    if(pdQtyInput){
      pdQtyInput.addEventListener('input', function(){
        const v = parseInt(pdQtyInput.value) || 1;
        pdQtyInput.value = v < 1 ? 1 : v;
      });
    }

    // ƒê√≥ng modal khi click overlay (kh√¥ng ph·∫£i n·ªôi dung)
    const pdModalEl = document.getElementById('pdModal');
    const pdContent = pdModalEl.querySelector('div > div');
    pdModalEl.addEventListener('click', function(e){
      if(e.target === pdModalEl){
        closeProductDetail();
      }
    });
    // Prevent clicks inside content from closing modal
    if(pdContent) pdContent.addEventListener('click', function(e){ e.stopPropagation(); });

    // Delegation for thumbnail taps (in case thumbs are added dynamically)
    pdModalEl.addEventListener('click', function(e){
      const t = e.target;
      if(t && t.tagName === 'IMG' && t.parentElement && t.parentElement.classList.contains('pd-thumbs')){
        const mainImg = pdModalEl.querySelector('.pd-main-img');
        mainImg.src = t.src;
        pdModalEl.querySelectorAll('.pd-thumbs img').forEach(x=>x.classList.remove('active'));
        t.classList.add('active');
      }
    });

    
    // Th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng ‚Äî qty t√πy ch·ªçn (m·∫∑c ƒë·ªãnh 1)
    // ‚úÖ Ch·ªâ cho ph√©p mua khi ƒë√£ ƒëƒÉng nh·∫≠p
function addToCart(name, price, img) {
  const loggedUser = localStorage.getItem("loggedUser");
  if (!loggedUser) {
    alert("‚ö†Ô∏è B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p tr∆∞·ªõc khi mua h√†ng!");
    return; // Ng·ª´ng l·∫°i, kh√¥ng th√™m v√†o gi·ªè
  }

  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  let existing = cart.find(item => item.name === name);
  if (existing) {
    existing.quantity++;
  } else {
    cart.push({ name, price, img, quantity: 1 });
  }
  localStorage.setItem("cart", JSON.stringify(cart));
  updateCartCount();
  showSnackbar("ƒê√£ th√™m m·ªôt s·∫£n ph·∫©m v√†o gi·ªè h√†ng");
}

    // Snackbar functions
    function showSnackbar(message){
      const sb = document.getElementById('snackbar');
      if(!sb) return;
      sb.querySelector('.sb-msg').textContent = message;
      sb.classList.add('show');
      // auto hide
      if(window._sbTimer) clearTimeout(window._sbTimer);
      window._sbTimer = setTimeout(()=> sb.classList.remove('show'), 3500);
    }

    const viewCartBtn = document.getElementById('viewCartBtn');
    if(viewCartBtn){
      viewCartBtn.addEventListener('click', function(){ window.location.href = 'cart.html'; });
    }

    // Render khi load
    renderProducts();

    // Khi user quay l·∫°i trang t·ª´ history (back), m·ªôt s·ªë tr√¨nh duy·ªát d√πng bfcache v√† kh√¥ng reload script;
    // l·∫Øng nghe pageshow ƒë·ªÉ c·∫≠p nh·∫≠t l·∫°i s·ªë l∆∞·ª£ng gi·ªè v√† danh s√°ch s·∫£n ph·∫©m ƒë·ªÉ c√≥ th·ªÉ ti·∫øp t·ª•c mua s·∫Øm.
    window.addEventListener('pageshow', function (event) {
      // event.persisted true n·∫øu t·ª´ bfcache
      updateCartCount();
      renderProducts();
    });

    // N√∫t ho√†n t√°c b·ªô l·ªçc (reset)
    const resetBtnEl = document.getElementById('resetFilterBtn');
    if(resetBtnEl){
      resetBtnEl.addEventListener('click', function(){
        window.location.href = 'product.html';
      });
    }
</script>
<!-- ‚úÖ Ki·ªÉm tra ƒëƒÉng nh·∫≠p v√† hi·ªÉn th·ªã l·ªùi ch√†o 3 gi√¢y + n√∫t ƒêƒÉng xu·∫•t -->
<script>
  const loggedUser = localStorage.getItem("loggedUser");
  if (loggedUser) {
    const navbar = document.querySelector(".navbar-nav");
    if (navbar && !document.getElementById("greetingNavItem")) {
      const li = document.createElement("li");
      li.className = "nav-item d-flex align-items-center";
      li.id = "greetingNavItem";

      const span = document.createElement("span");
      span.className = "nav-link text-success fw-bold";
      span.id = "greetingText";
      span.textContent = `Xin ch√†o, ${loggedUser.split("@")[0]} üëã`;

      const btn = document.createElement("button");
      btn.className = "btn btn-outline-light btn-sm ms-2";
      btn.textContent = "ƒêƒÉng xu·∫•t";

      li.appendChild(span);
      li.appendChild(btn);
      navbar.appendChild(li);

      // Sau 3 gi√¢y t·ª± ·∫©n l·ªùi ch√†o, ch·ªâ c√≤n n√∫t ƒëƒÉng xu·∫•t
      setTimeout(() => {
        const g = document.getElementById("greetingText");
        if (g) g.style.display = "none";
      }, 3000);

      // Khi nh·∫•n "ƒêƒÉng xu·∫•t" ‚Üí x√≥a ƒëƒÉng nh·∫≠p v√† quay v·ªÅ trang ch·ªß
      btn.addEventListener("click", () => {
        localStorage.removeItem("loggedUser");
        alert("B·∫°n ƒë√£ ƒëƒÉng xu·∫•t!");
        location.href = "index.html";
      });
    }
  }
</script>
</body>
</html>
